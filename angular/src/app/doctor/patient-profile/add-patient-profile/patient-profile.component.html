<section class="content">
  <div class="container-fluid">
    <div class="block-header">
      <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
          <ul class="breadcrumb breadcrumb-style ">
            <li class="breadcrumb-item">
              <h4 class="page-title"> {{model.patientModel?.patientName}} ({{model.patientModel?.age}})</h4>
            </li>
            <li class="breadcrumb-item bcrumb-1">
              <a routerLink="/doctor/dashboard">
                <i class="fas fa-home"></i> Home</a>
            </li>
            <li class="breadcrumb-item bcrumb-2">
              <a href="#" onClick="return false;">Patient Profile</a>
            </li>
            <!-- <li class="breadcrumb-item active"> {{model.patientModel?.patientName}} ({{model.patientModel?.age}})</li> -->
          </ul>
        </div>
      </div>
    </div>

    <div class="row clearfix">
      <div class="col-lg-10 col-md-9 col-12">
        <mat-accordion>
          <mat-expansion-panel [expanded]="step === 0" (opened)="step=0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Profile
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row align-items-center" *ngIf="!templateLoading">
              <div class="row align-items-center">
                <ng-template #templateSelection>
                  <div class="col-9 mb-2">
                    <mat-form-field class="example-full-width" appearance="outline">
                      <mat-label>Select Template</mat-label>
                      <mat-chip-list #chipList aria-label="Template selection">
                        <mat-chip *ngFor="let template of selectedTemplateObjsTemp; let index = index" selectable="true"
                          removable="true">
                          {{template.name}}
                          <button matChipRemove (click)="removeChip(index, true)">
                            <mat-icon>cancel</mat-icon>
                          </button>
                        </mat-chip>
                        <input placeholder="Template Name" #templateCtrl="ngModel" name="template"
                          [(ngModel)]="selectedTemplateName" [matAutocomplete]="autoTemp" [matChipInputFor]="chipList"
                          [matChipInputSeparatorKeyCodes]="separatorKeysCodes">
                      </mat-chip-list>
                      <mat-autocomplete #autoTemp="matAutocomplete" (optionSelected)="addTemplate($event)">
                        <mat-option *ngFor="let template of templateList" [value]="template.name">
                          {{template.name}}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                  </div>
                  <div class="col-3 mb-2">
                    <button (click)="saveTemplate()" class="btn btn-success me-2">Done</button>
                    <button (click)="cancel()" class="btn btn-danger">Cancel</button>
                  </div>
                </ng-template>
                <div class="col-12 mb-2" *ngIf="isTemplateSelected; else templateSelection">
                  <ng-template #displayTemp>
                    <mat-chip-list aria-label="Template Display">
                      <mat-chip *ngFor="let template of selectedTemplateObjs; let index = index" selectable="true"
                        removable="true">
                        {{template.name}}
                        <button matChipRemove (click)="removeChip(index)">
                          <mat-icon>cancel</mat-icon>
                        </button>
                      </mat-chip>
                      <mat-chip *ngIf="selectedTemplateObjs?.length > 0">
                        <button class="btn btn-link" (click)="addMore()">
                          Add More
                        </button>
                      </mat-chip>
                    </mat-chip-list>
                  </ng-template>
                  <button *ngIf="!selectedTemplateObj.name; else displayTemp"
                    (click)="isTemplateSelected = !isTemplateSelected" ngbTooltip="Add template"
                    class="pull-right btn btn-sm btn-primary">
                    <i class="fas fa-plus-circle primary"></i> Template
                  </button>
                </div>
              </div>
            </div>
            <div class="row cust-margin" *ngIf="templateLoading">
              Loading Templates...
            </div>
            <!-- <div class="row cust-margin" *ngIf="!diagLoading">
              <div class="col-md-12 col-12">
                <button class="btn btn-sm btn-primary" *ngIf="showAddDiagnosis()" (click)="addDiag()">
                  Add Diagnosis
                </button>
              </div>

              <div class="col-12" *ngFor="let each of model.patientDiagnosisModel; let index = index; last as isLast">
                <div class="row align-items-center" *ngIf="!each.isDeleted && diagOptions.length > 0">
                  <div class="col-md-5 col-12">
                    <mat-form-field class="example-full-width" appearance="outline">
                      <mat-label>Diagnosis</mat-label>
                      <input matInput [matAutocomplete]="autoDiag" name="selectInvestigation"
                        #selectInvestigation="ngModel" [(ngModel)]="each.diagnosisMasterName"
                        (ngModelChange)="doDiagFilter(each.diagnosisMasterName)">
                    </mat-form-field>
                    <mat-autocomplete autoActiveFirstOption #autoDiag="matAutocomplete"
                      (optionSelected)="onDiagSelectionChanged($event, each)">
                      <mat-option *ngFor="let eachOption of diagOptions[index].model" [value]="eachOption.name">
                        {{eachOption.name}}
                      </mat-option>
                    </mat-autocomplete>
                  </div>
                  <div class="col-md-6 col-12">
                    <mat-form-field class="example-full-width" appearance="outline">
                      <mat-label>Description</mat-label>
                      <input matInput [(ngModel)]="each.description" name="description{{index}}">
                    </mat-form-field>
                  </div>
                  <div class="col-md-1 col-12 col-btn">
                    <i class="fas fa-trash-alt" ngbTooltip="Delete Diagnosis" [openDelay]="500"
                      (click)="removeDiag(index)"></i>
                    <i class="fas fa-plus-circle" ngbTooltip="Add Diagnosis" [openDelay]="500" (click)="addDiag()"></i>
                  </div>
                  <div class="col-md-1 col-12 col-btn" *ngIf="index !== model.patientDiagnosisModel.length - 1">
                    
                  </div>
                </div>
              </div>
            </div> -->
            <div class="row align-items-center">
              <div class="col-12 mb-2">
                <mat-card>
                  <h5>Diagnosis</h5>
                </mat-card>
              </div>
              <div class="col-12 mb-2" *ngIf="!isDiagSelected">
                <!-- <ng-template #diagsSelection> -->
                <div class="col-9 mb-2">
                  <div class="row align-items-center">
                    <div class="col-md-9 col-12">
                      <mat-form-field class="example-full-width" appearance="outline">
                        <mat-label>Diagnosis</mat-label>
                        <mat-chip-list #chipDiagList aria-label="Diagnosis selection">
                          <mat-chip *ngFor="let template of model.patientDiagnosisModel; let index = index"
                            selectable="true" removable="true">
                            {{template.diagnosisMasterName}}
                            <button matChipRemove (click)="removeDiagChip(index, true)">
                              <mat-icon>cancel</mat-icon>
                            </button>
                          </mat-chip>
                          <input placeholder="Diagnosis Name" #diagCtrl="ngModel" name="diag"
                            [(ngModel)]="selectedDiagName" [matAutocomplete]="autoTemp" [matChipInputFor]="chipDiagList"
                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes">
                        </mat-chip-list>
                        <mat-autocomplete #autoTemp="matAutocomplete" (optionSelected)="addDiag($event)">
                          <mat-option *ngFor="let template of diagosisList" [value]="template.name">
                            {{template.name}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>
                    <div class="col-3 mb-2">
                      <button (click)="saveDiags()" class="btn btn-success me-2">Done</button>
                      <button [disabled]="model.patientDiagnosisModel?.length < 1" (click)="cancelDiags()"
                        class="btn btn-danger">Cancel</button>
                    </div>
                  </div>
                </div>
                <!-- </ng-template> -->
              </div>
              <div class="col-12 mb-2" *ngIf="isDiagSelected">
                <!-- <ng-template #displayDiags> -->
                <mat-chip-list aria-label="Template Display">
                  <mat-chip *ngFor="let template of model.patientDiagnosisModel; let index = index" selectable="true"
                    removable="true">
                    {{template.diagnosisMasterName}}
                    <button matChipRemove (click)="removeDiagChip(index)">
                      <mat-icon>cancel</mat-icon>
                    </button>
                  </mat-chip>
                  <mat-chip *ngIf="model.patientDiagnosisModel?.length > 0">
                    <button class="btn btn-link" (click)="addMoreDigs()">
                      Add More
                    </button>
                  </mat-chip>
                </mat-chip-list>
                <!-- </ng-template> -->
                <button *ngIf="!selectedTemplateObj.name; else displayTemp" (click)="isDiagSelected = !isDiagSelected"
                  ngbTooltip="Add Diagnosis" class="pull-right btn btn-sm btn-primary">
                  <i class="fas fa-plus-circle primary"></i> Diagnosis
                </button>
              </div>

            </div>
            <div class="row">
              <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12">
                <div class="card">
                  <form class="m-4" #f="ngForm">
                    <!-- <div class="row">
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label>Name</mat-label>
                            <input matInput name="name" #name="ngModel" [(ngModel)]="model." required>
                            <mat-error *ngIf="name.invalid && (name.dirty || name.touched)">
                              <span *ngIf="name.errors?.['required']"> Name is required</span>
                            </mat-error>
                          </mat-form-field>
                        </div>
                      </div> -->
                    <div class="row">
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Complaints</mat-label>
                          <input matInput [matAutocomplete]="autoCompliants" name="compliants" #compliants="ngModel"
                            [(ngModel)]="selectedComplaint" (ngModelChange)="doComplaintFilter(selectedComplaint)">
                          <mat-autocomplete #autoCompliants="matAutocomplete">
                            <mat-option *ngFor="let template of complaintsOptions" [value]="template">
                              {{template}}
                            </mat-option>
                          </mat-autocomplete>
                          <mat-error *ngIf="compliants.invalid && (compliants.dirty || compliants.touched)">
                            <span *ngIf="compliants.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Examination</mat-label>
                          <textarea maxlength="1000" matInput name="examination" #examination="ngModel"
                            [(ngModel)]="model.examination">
                          </textarea>
                          <mat-error *ngIf="examination.invalid && (examination.dirty || examination.touched)">
                            <span *ngIf="examination.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Past History</mat-label>
                          <textarea maxlength="1000" matInput name="pastHistory" #pastHistory="ngModel"
                            [(ngModel)]="model.pastHistory">
                          </textarea>
                          <mat-error *ngIf="pastHistory.invalid && (pastHistory.dirty || pastHistory.touched)">
                            <span *ngIf="pastHistory.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Investigation Results</mat-label>
                          <textarea maxlength="1000" matInput name="investigationResults"
                            #investigationResults="ngModel" [(ngModel)]="model.investigationResults">
                          </textarea>
                          <mat-error
                            *ngIf="investigationResults.invalid && (investigationResults.dirty || investigationResults.touched)">
                            <span *ngIf="investigationResults.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Impression</mat-label>
                          <textarea maxlength="1000" matInput name="impression" #impression="ngModel"
                            [(ngModel)]="model.impression">
                          </textarea>
                          <mat-error *ngIf="impression.invalid && (impression.dirty || impression.touched)">
                            <span *ngIf="impression.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Advice</mat-label>
                          <textarea maxlength="1000" matInput name="advice" #advice="ngModel"
                            [(ngModel)]="model.advice">
                          </textarea>
                          <mat-error *ngIf="advice.invalid && (advice.dirty || advice.touched)">
                            <span *ngIf="advice.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Plan</mat-label>
                          <textarea maxlength="1000" matInput name="plan" #plan="ngModel" [(ngModel)]="model.plan">
                          </textarea>
                          <mat-error *ngIf="plan.invalid && (plan.dirty || plan.touched)">
                            <span *ngIf="plan.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field>
                      </div>
                      <div class="col-xl-6 col-lg-6 col-md-12 col-sm-12 mb-3">
                        <section class="example-section">
                          <mat-checkbox [(ngModel)]="model.isfollowUpNeed" name="isfollowUpNeed">Follow Up Needed
                          </mat-checkbox>
                        </section>
                        <section class="example-section" *ngIf="model.isfollowUpNeed">
                          <mat-form-field class="example-full-width mb-3" appearance="outline">
                            <mat-label> Date & Time</mat-label>
                            <input matInput [owlDateTimeTrigger]="date2" [owlDateTime]="date2" #followUp="ngModel"
                              name="followUp" [(ngModel)]="model.followUp" [min]="today">
                            <mat-icon matSuffix [owlDateTimeTrigger]="date2" class="date-icon">today</mat-icon>
                            <owl-date-time #date2></owl-date-time>
                            <mat-error *ngIf="followUp.invalid && (followUp.dirty || followUp.touched)">
                              <span *ngIf="followUp.errors?.['required']"> FollowUp is required</span>
                            </mat-error>
                          </mat-form-field>
                        </section>
                        <!-- <mat-form-field class="example-full-width mb-3" appearance="outline">
                          <mat-label>Follow Up</mat-label>
                          <textarea maxlength="1000" matInput name="followUp" #followUp="ngModel"
                            [(ngModel)]="model.followUp">
                          </textarea>
                          <mat-error *ngIf="followUp.invalid && (followUp.dirty || followUp.touched)">
                            <span *ngIf="followUp.errors?.['maxlength']"> Max Length is 1000</span>
                          </mat-error>
                        </mat-form-field> -->
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel [expanded]="step === 1" (opened)="step=1">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Prescription
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row">
              <div class="col-12 text-right m-1">
                <button class="btn btn-primary btn-sm" (click)="printPrescrption()">
                  Print Preview
                </button>
              </div>
              <app-prescription (editMode)="edit($event)" [medList]="model.prescriptionModel"></app-prescription>
              <div class="col-12">
                <div class="row" *ngIf="newMed">
                  <div class="col-md-3 col-12">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Medicine Name</mat-label>
                      <span matPrefix>
                        <i class="material-icons">search</i>
                      </span>
                      <input matInput [matAutocomplete]="autoMed" name="medicineName" #medicineName="ngModel"
                        [disabled]="action == 'edit'" [(ngModel)]="selectedMedicine"
                        (ngModelChange)="doMedFilter(selectedMedicine)">
                      <mat-hint> <span class="bolder font-large">

                          {{activePrescription.medicineName}}-{{activePrescription.categoryName}}-{{activePrescription.strength}}{{activePrescription.units}}</span>
                      </mat-hint>
                      <mat-error *ngIf="medicineName.invalid && (medicineName.dirty || medicineName.touched)">
                        <span *ngIf="medicineName.errors?.['required']"> Medicine Name is required</span>
                      </mat-error>
                    </mat-form-field>
                    <mat-autocomplete autoActiveFirstOption #autoMed="matAutocomplete"
                      (optionSelected)="onMedSelectionChanged($event)">
                      <mat-option *ngFor="let eachOption of prescriptionOptions" [value]="eachOption.id">
                        {{eachOption.medicineName}}-{{eachOption.categoryName}}-{{eachOption.strength}}{{eachOption.units}}
                      </mat-option>
                    </mat-autocomplete>
                  </div>
                  <div class="col-md-2 col-12">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Strength</mat-label>
                      <input maxlength="50" readonly matInput [(ngModel)]="activePrescription.strength" name="strength">

                    </mat-form-field>
                  </div>
                  <div class="col-md-3 col-12">
                    <section class="example-section">
                      <mat-checkbox [(ngModel)]="activePrescription.sos" name="sos">
                        Sos</mat-checkbox>
                      <mat-checkbox [(ngModel)]="activePrescription.stat" name="stat">
                        Stat</mat-checkbox>
                    </section>
                    <mat-radio-group aria-label="schedule" [(ngModel)]="activePrescription.beforeFood">
                      <mat-radio-button [value]="true">Before Food</mat-radio-button>
                      <mat-radio-button [value]="false">After Food</mat-radio-button>
                    </mat-radio-group>
                    <section class="example-section">
                      <mat-checkbox [(ngModel)]="activePrescription.morning" name="morning">
                        Morning</mat-checkbox>
                      <mat-checkbox [(ngModel)]="activePrescription.noon" name="noon">Noon
                      </mat-checkbox>
                      <mat-checkbox [(ngModel)]="activePrescription.night" name="night">Night
                      </mat-checkbox>
                    </section>
                  </div>
                  <div class="col-md-2 col-12">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>Remarks </mat-label>
                      <input maxlength="500" matInput [(ngModel)]="activePrescription.remarks" name="remarks">
                    </mat-form-field>
                  </div>
                  <div class="col-md-2 col-12">
                    <mat-form-field class="example-full-width mb-3" appearance="outline">
                      <mat-label>No of Days </mat-label>
                      <input #noOfDays="ngModel" matInput [(ngModel)]="activePrescription.noOfDays" name="noOfDays"
                        type="number" [min]="1" required>
                      <mat-error *ngIf="noOfDays.invalid && (noOfDays.dirty || noOfDays.touched)">
                        <span *ngIf="noOfDays.errors?.['required']"> No Of Days is required</span>
                        <span *ngIf="noOfDays.errors?.['min']"> No Of Days must be minimum of 1</span>
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <div class="col-12 text-center">
                    <button [disabled]="!activePrescription.medicineName ||  !activePrescription.noOfDays"
                      (click)="addPrescription()" class="btn btn-sm btn-success mr-2">Done</button>
                    &nbsp; <button (click)="cancelPrescription()" class="btn btn-sm btn-danger mr-2">Cancel</button>
                  </div>
                </div>
                <div class="col-12 text-center" *ngIf="!newMed">
                  <button (click)="addMed()" class="btn btn-sm btn-primary">Add</button>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
        <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 mb-3 p-3">
            <button *ngIf="!id" (click)="onSubmit()" class="btn-space" [disabled]="!f.form.valid || newMed"
              mat-raised-button color="primary">Submit</button>
            <button *ngIf="id" (click)="update()" class="btn-space" [disabled]="!f.form.valid || newMed"
              mat-raised-button color="primary">Update</button>
            <button routerLink="/doctor/dashboard" type="button" mat-button>Cancel</button>
          </div>
        </div>
      </div>
      <div class="col-lg-2 col-md-3 col-12 side-panel">
        <mat-accordion>
          <mat-expansion-panel [expanded]="vitalStep === 0" (opened)="vitalStep=0" class="side-accordian">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Results
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row">
              <div class="col-md-12">
                <ul>
                  <li class="text-left">
                    <button class="btn btn-lg btn-link" style="text-align: left;"
                      (click)="openModel(investigation)">Investigation</button>
                  </li>
                  <li>
                    <button class="btn btn-lg btn-link" style="text-align: left;" (click)="openModel(visits)">Past
                      Visits</button>
                  </li>
                </ul>
              </div>
            </div>
          </mat-expansion-panel>
          <mat-expansion-panel [expanded]="vitalStep === 1" (opened)="vitalStep=1">
            <mat-expansion-panel-header>
              <mat-panel-title>
                Vitals
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="row" *ngIf="model?.appointment?.vitalsReportModel?.height|| model?.appointment?.vitalsReportModel?.weight
            || model?.appointment?.vitalsReportModel?.spO2 || model?.appointment?.vitalsReportModel?.pulse 
            || model?.appointment?.vitalsReportModel?.temprature">
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline">
                  <mat-label>Temperature</mat-label>
                  <input matInput type="number" readonly [(ngModel)]="model.appointment.vitalsReportModel.temprature"
                    name="temprature" />
                  <span matSuffix>&#8451;</span>
                </mat-form-field>
              </div>
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline">
                  <mat-label>SpO2</mat-label>
                  <input matInput type="number" readonly [(ngModel)]="model.appointment.vitalsReportModel.spO2"
                    name="spO2">
                  <span matSuffix>%</span>
                </mat-form-field>
              </div>
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline">
                  <mat-label>Pulse</mat-label>
                  <input matInput type="number" readonly [(ngModel)]="model.appointment.vitalsReportModel.pulse"
                    name="pulse">
                  <span matSuffix>/min</span>
                </mat-form-field>
              </div>
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline" name="bp">
                  <mat-label>BP</mat-label>
                  <input matInput type="text" readonly mask="000/00"
                    [(ngModel)]="model.appointment.vitalsReportModel.bloodPresure">
                  <span matSuffix>mmHg</span>
                </mat-form-field>
              </div>
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline">
                  <mat-label>Weight</mat-label>
                  <input matInput type="number" readonly [(ngModel)]="model.appointment.vitalsReportModel.weight"
                    name="weight">
                  <span matSuffix>kg</span>
                </mat-form-field>
              </div>
              <div class="col-md-12 mb-0">
                <mat-form-field class="example-full-width mb-3" appearance="outline">
                  <mat-label>Height</mat-label>
                  <input matInput type="number" readonly [(ngModel)]="model.appointment.vitalsReportModel.height"
                    name="height">
                  <span matSuffix>cm</span>
                </mat-form-field>
              </div>
              <div class="col-12 mb-0">
                <button class="btn btn-lg btn-link" (click)="openModel(pastHistory)">Past Reports</button>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </div>
  </div>
</section>

<ng-template #pastHistory let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Past Reports</h3>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row" *ngIf="model.appointment.patientFiles?.length > 0">
      <ul class="list-group">
        <li class="list-group-item" *ngFor="let eachFile of model.appointment.patientFiles">
          <a [download]="eachFile.fileName" [href]="eachFile.filePath">{{eachFile.fileName}}</a>
        </li>
        <ng-template *ngIf="!(model.appointment.patientFiles?.length > 0)">
          <li class="list-group-item">
            No data found
          </li>
        </ng-template>
      </ul>
    </div>
  </div>
</ng-template>

<ng-template #visits let-modal minWidth="400">
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Past Visit</h3>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row head-row">
      <div class="col-md-4 col-12">
        <h5 class="mb-0">Doctor</h5>
      </div>
      <div class="col-md-3 col-12">
        <h5 class="mb-0">Date</h5>
      </div>
      <div class="col-md-4 col-12">
        <h5 class="mb-0">Treatment</h5>
      </div>
      <div class="col-md-1 col-12">

      </div>
    </div>
    <ng-template #noData>
      <div class="row head-row">
        <div class="col-md-12 col-12">
          No data found
        </div>
      </div>
    </ng-template>
    <ngb-accordion *ngIf="pastHistoryList?.length > 0; else noData" [closeOthers]="true" class="acc-btn-last">
      <ngb-panel id="visit-1" *ngFor="let each of pastHistoryList">
        <ng-template ngbPanelHeader let-opened="each?.appointment?.isOpened">
          <div class="row">
            <div class="col-md-4 col-12">
              <h6 class="mb-0">{{each?.appointment?.consultingDoctorName}}</h6>
            </div>
            <div class="col-md-3 col-12">
              <h6 class="mb-0 btn-link" (click)="goto(each?.appointmentId)">
                {{each?.appointment?.appointmentDateTime | date: 'dd/MM/yyyy'}}
              </h6>
            </div>
            <div class="col-md-4 col-12">
              <h6 class="mb-0">{{each?.appointment?.description}}</h6>
            </div>
            <div class="col-md-1 col-12">
              <button ngbPanelToggle class="btn btn-link p-0" (click)="changeOpened(each)">
                <i class="fas fa-minus" *ngIf="each?.appointment?.isOpened"></i>
                <i *ngIf="!each?.appointment?.isOpened" class="fas fa-plus-circle"></i>
              </button>
            </div>
          </div>
        </ng-template>
        <ng-template *ngIf="!each.prescriptionModel || each.prescriptionModel?.length == 0" ngbPanelContent>
          No data found
        </ng-template>

        <ng-template ngbPanelContent *ngIf="each.prescriptionModel?.length > 0">
          <app-prescription [medList]="each.prescriptionModel" [readyOnly]="true"></app-prescription>
        </ng-template>
      </ngb-panel>
    </ngb-accordion>
  </div>
  <!-- <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Save</button>
  </div> -->
</ng-template>
<ng-template #investigation let-modal>
  <div class="modal-header">
    <h3 class="modal-title" id="modal-basic-title">Investigation
      Results</h3>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">

      <div class="col-12 mb-2" *ngIf="!isTestSelected">
        <!-- <ng-template #diagsSelection> -->

        <div class="row align-items-center">
          <div class="col-md-9 col-12">
            <mat-form-field class="example-full-width" appearance="outline">
              <mat-label>Investigation</mat-label>
              <mat-chip-list #chipTestList aria-label="Diagnosis selection">
                <mat-chip *ngFor="let template of model.patientTestModel; let index = index" selectable="true"
                  removable="true">
                  {{template.testMasterName}}
                  <button matChipRemove (click)="removeTestChip(index, true)">
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
                <input #testCtrl="ngModel" name="diag" [(ngModel)]="selectedTestName" [matAutocomplete]="autoTemp"
                  [matChipInputFor]="chipTestList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes">
              </mat-chip-list>
              <mat-autocomplete #autoTemp="matAutocomplete" (optionSelected)="addTest($event)">
                <mat-option *ngFor="let template of inestigationOptions" [value]="template.name">
                  {{template.name}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
          <div class="col-3 mb-2">
            <button (click)="saveTest()" class="btn btn-success me-2">Done</button>
            <button [disabled]="model.patientTestModel?.length < 1" (click)="cancelTest()"
              class="btn btn-danger">Cancel</button>
          </div>

        </div>
        <!-- </ng-template> -->
      </div>
      <div class="col-12 mb-2" *ngIf="isTestSelected">
        <!-- <ng-template #displayDiags> -->
        <mat-chip-list aria-label="Template Display">
          <mat-chip *ngFor="let template of model.patientTestModel; let index = index" selectable="true"
            removable="true">
            {{template.testMasterName}}
            <button matChipRemove (click)="removeTestChip(index)">
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
          <mat-chip *ngIf="model.patientTestModel?.length > 0">
            <button class="btn btn-link" (click)="addMoreTest()">
              Add More
            </button>
          </mat-chip>
        </mat-chip-list>
        <!-- </ng-template> -->
        <!-- <button *ngIf="!selectedTemplateObj.name; else displayTemp" (click)="isDiagSelected = !isDiagSelected"
          ngbTooltip="Add Diagnosis" class="pull-right btn btn-sm btn-primary">
          <i class="fas fa-plus-circle primary"></i> Diagnosis
        </button> -->
      </div>

      <!-- <div class="col-12" *ngIf="!model.patientTestModel || model.patientTestModel?.length == 0">
        <button (click)="addInestigation()" class="pull-right btn btn-sm btn-primary">
          <i class="fas fa-plus-circle"></i>Add
        </button>
      </div>
      <div class="col-12" *ngFor="let each of model.patientTestModel; let index = index;">
        <div class="row align-items-center">
          <div class="col-md-5 col-12 mb-3">
            <mat-form-field class="example-full-width" appearance="outline">
              <mat-label>Test</mat-label>
              <input matInput [matAutocomplete]="auto" name="selectInvestigation" #selectInvestigation="ngModel"
                [(ngModel)]="each.testMasterName" (ngModelChange)="doFilter(each.testMasterName)">
            </mat-form-field>
            <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete"
              (optionSelected)="onSelectionChanged($event, each)">
              <mat-option *ngFor="let eachOption of inestigationOptions" [value]="eachOption.name">
                {{eachOption.name}}
              </mat-option>
            </mat-autocomplete>
          </div>
          <div class="col-md-5 col-12 mb-3">
            <mat-form-field class="example-full-width" appearance="outline">
              <mat-label>Remarks </mat-label>
              <input maxlength="500" #remarks="ngModel" matInput [(ngModel)]="each.remarks" name="remarks">
              <mat-error *ngIf="remarks.invalid && (remarks.dirty || remarks.touched)">
                <span *ngIf="remarks.errors?.['maxlength']"> Max Length is 1000</span>
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-2 col-12 col-btn mb-3" *ngIf="index == model.patientTestModel?.length - 1">
            <i class="fas fa-trash-alt" (click)="removeInestigation()"></i>
            <i class="fas fa-plus-circle" (click)="addInestigation()"></i>
          </div>
        </div>
      </div> -->
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close()">Done</button>
  </div>
</ng-template>


<div class="hidden">
  <div class="card" id="section-to-print" *ngIf="model?.patientModel?.patientName">

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-10 col-sm-10 col-xs-10">
          <!-- <img style="width: 250px;padding: 10px;" class="mx-auto d-block"
            src="http://pisystemsimran-001-site1.dtempurl.com/assets/images/pih-logo.png"> -->
        </div>
        <div class="col-md-2 col-sm-2 col-xs-2 text-right">
          <button id="print-btn" onclick="printing()" class="mt-1 btn btn-sm btn-primary">Print</button>
        </div>
      </div>
      <div class="col-md-8 col-sm-8 col-xs-8" style="border: 1px solid #000;padding: 10px;">
        <div>
          <strong> Name: </strong> {{model?.patientModel?.patientName}}
        </div>
        <div>
          <strong>Gender (Age): </strong> {{model.patientModel?.gender}} {{model.patientModel?.age}}
        </div>
        <div>
          <strong> Consultant:</strong> {{model.appointment?.consultingDoctorName}}
        </div>
      </div>
      <div class="col-md-4 col-sm-4 col-xs-4" style="border: 1px solid #000;padding: 10px;border-left: none;">
        <div>
          <strong>Date: </strong> {{model?.appointment?.appointmentDateTime | date}}
        </div>
        <div>
          <strong>UHID: </strong> {{model?.patientModel?.ulId}}
        </div>
        <div style="color: transparent">.</div>
      </div>
      <div class="col-md-12 col-sm-12" style="padding: 25px;"
        style="border: 1px solid #000;border-top: none;padding-top: 10px;">
        <div class="row clearfix">
          <div class="col-md-12 col-sm-12 col-xs-12">
            <div *ngIf="model.compliants" class="row">
              <div class="col-md-3 col-sm-3 col-xs-3">
                <strong>Complaints</strong>
              </div>
              <div class="col-md-9 col-sm-9 col-xs-9">
                : {{model.compliants}}
              </div>
            </div>
            <div *ngIf="model.patientTestModel?.length > 0" class="row clearfix">
              <div class="col-md-3 col-sm-3 col-xs-3">
                <strong>Investigation Results</strong>
              </div>
              <div class="col-md-9 col-sm-9 col-xs-9">
                : <span *ngFor="let each of model.patientTestModel">
                  {{each.testMasterName}} {{each.remarks}} &nbsp;
                </span>
              </div>
            </div>
            <div *ngIf="model.impression" class="row clearfix">
              <div class="col-md-3 col-sm-3 col-xs-3">
                <strong>Impression</strong>
              </div>
              <div class="col-md-9 col-sm-9 col-xs-9">
                : {{model.impression}}
              </div>
            </div>
            <div *ngIf="model.advice" class="row clearfix">
              <div class="col-md-3 col-sm-3 col-xs-3">
                <strong>Advice</strong>
              </div>
              <div class="col-md-9 col-sm-9 col-xs-9">
                : {{model.advice}}
              </div>
            </div>
          </div>
          <div class="col-md-1 col-sm-1 col-xs-12" style="margin-top: 10px;">
            <table class="table table-bordered">
              <thead>
                <tr class="row">
                  <th class="col-md-1 col-sm-1 col-xs-1">
                    Rx
                  </th>
                  <th class="col-md-8 col-sm-8 col-xs-8">
                    Medicine Name
                  </th>
                  <th class="col-md-1 col-sm-1 col-xs-1">
                    Frequency
                  </th>
                  <th class="col-md-1 col-sm-1 col-xs-1">
                    Duration
                  </th>
                  <th class="col-md-1 col-sm-1 col-xs-1">
                    Notes
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr class="row" *ngFor="let each of model.prescriptionModel; let index = index">
                  <td class="col-md-1 col-sm-1 col-xs-1">
                    {{index + 1}}
                  </td>
                  <td class="col-md-8 col-sm-8 col-xs-8">
                    {{each.medicineName}} - {{each.strength}} ({{each.genericName ? each.genericName :
                    each.medicineName}}) {{each.categoryName ? each.categoryName : ''}}{{each.units ? each.units : ''}}
                  </td>
                  <td class="col-md-1 col-sm-1 col-xs-1">
                    {{each.morning ? 1 : 0}}-{{each.noon? 1:0}}-{{each.night? 1: 0}}
                  </td>
                  <td class="col-md-1 col-sm-1 col-xs-1">
                    {{each.noOfDays}} Day(s)
                  </td>
                  <td class="col-md-1 col-sm-1 col-xs-1">
                    {{each.beforeFood ? "Before Food": "After Food"}} {{each.remarks?.toLowerCase().indexOf('food') > -1
                    ? '' : each.remarks}}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>